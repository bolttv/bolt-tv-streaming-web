exports.id=452,exports.ids=[452],exports.modules={26695:(a,b,c)=>{"use strict";c.d(b,{$m:()=>r,AV:()=>k,CI:()=>f,Cp:()=>q,Du:()=>i,GV:()=>o,Y_:()=>s,Yu:()=>m,ZZ:()=>l,c2:()=>j,dB:()=>h,k$:()=>p,o3:()=>t,te:()=>g,xX:()=>n}),process.env.JWPLAYER_SITE_ID,process.env.JWPLAYER_API_SECRET;class d{isValid(a){return!!a&&Date.now()-a.timestamp<a.ttl}getPlaylist(a){let b=this.playlistCache.get(a);return this.isValid(b)?b.data:null}setPlaylist(a,b,c=this.DEFAULT_TTL){this.playlistCache.set(a,{data:b,timestamp:Date.now(),ttl:c})}getMedia(a){let b=this.mediaCache.get(a);if(this.isValid(b))return b.data}setMedia(a,b,c=this.DEFAULT_TTL){this.mediaCache.set(a,{data:b,timestamp:Date.now(),ttl:c})}getSeriesEpisodes(a){let b=this.seriesEpisodesCache.get(a);return this.isValid(b)?b.data:null}setSeriesEpisodes(a,b){this.seriesEpisodesCache.set(a,{data:b,timestamp:Date.now(),ttl:this.SERIES_TTL})}getSeriesInfo(a){let b=this.seriesInfoCache.get(a);return this.isValid(b)?b.data:null}setSeriesInfo(a,b){this.seriesInfoCache.set(a,{data:b,timestamp:Date.now(),ttl:this.SERIES_TTL})}getCacheStats(){return{playlists:this.playlistCache.size,media:this.mediaCache.size,series:this.seriesEpisodesCache.size+this.seriesInfoCache.size}}constructor(){this.playlistCache=new Map,this.mediaCache=new Map,this.seriesEpisodesCache=new Map,this.seriesInfoCache=new Map,this.DEFAULT_TTL=3e5,this.SERIES_TTL=6e5}}let e=new d,f={heroBanner:"KMhhEA3u",featured:"WqLLBMnx",recommended:"hkXBUtcd",popular:"8A1ZTwWl",newMovies:"SnbG7v6j",documentaries:"RytYkppn"},g=[{id:"PFauvVKV",name:"College",slug:"college"},{id:"QzHRrJRZ",name:"Soccer",slug:"soccer"},{id:"BC45vsNB",name:"Baseball",slug:"baseball"},{id:"FZgrLpfJ",name:"Football",slug:"football"},{id:"YY5zhjLQ",name:"Basketball",slug:"basketball"},{id:"iCwCBaL7",name:"Action Sports",slug:"action-sports"}];async function h(a){let b=e.getPlaylist(a);if(null!==b)return b;try{let b=await fetch(`https://cdn.jwplayer.com/v2/playlists/${a}`,{headers:{Accept:"application/json"}});if(!b.ok)return console.error(`JW Player Delivery API error: ${b.status} ${b.statusText}`),e.setPlaylist(a,[],3e4),[];let c=(await b.json()).playlist||[];return e.setPlaylist(a,c),c}catch(b){return console.error("Failed to fetch JW Player playlist:",b),e.setPlaylist(a,[],3e4),[]}}async function i(a){let b=e.getMedia(a);if(void 0!==b)return b;try{let b=await fetch(`https://cdn.jwplayer.com/v2/media/${a}`,{headers:{Accept:"application/json"}});if(!b.ok)return e.setMedia(a,null),null;let c=await b.json(),d=c.playlist?.[0]||null;return e.setMedia(a,d),d}catch(a){return console.error("Failed to fetch JW Player media:",a),null}}async function j(a){let b=e.getSeriesInfo(a);if(null!==b)return b;try{let b=await fetch(`https://cdn.jwplayer.com/apps/series/${a}`,{headers:{Accept:"application/json"}});if(!b.ok)return null;let c=await b.json();return e.setSeriesInfo(a,c),c}catch(a){return console.error("Failed to fetch JW Player series info:",a),null}}async function k(a,b=1){let c=`${a}_s${b}`,d=e.getSeriesEpisodes(c);if(null!==d)return d;try{let d=await fetch(`https://cdn.jwplayer.com/apps/series/${a}/seasons/${b}/episodes`,{headers:{Accept:"application/json"}});if(!d.ok)return console.error(`JW Player Series Episodes API error: ${d.status} ${d.statusText}`),[];let f=(await d.json()).episodes||[];return e.setSeriesEpisodes(c,f),f}catch(a){return console.error("Failed to fetch JW Player series episodes:",a),[]}}function l(a,b=480){return`https://cdn.jwplayer.com/v2/media/${a}/poster.jpg?width=${b}`}function m(a){return`https://cdn.jwplayer.com/v2/media/${a}/images/Vertical-Poster.jpg`}function n(a){return`https://cdn.jwplayer.com/v2/media/${a}/images/Horizontal-Poster-Logo.jpg`}function o(a){return`https://cdn.jwplayer.com/v2/media/${a}/poster.jpg?width=1280`}function p(a){return`https://cdn.jwplayer.com/v2/media/${a}/images/hero-banner-logo.png`}function q(a){if(!a)return null;let b=a.filter(a=>"video/mp4"===a.type);return 0===b.length?null:b.reduce((a,b)=>a.width>b.width?a:b).src}async function r(a){let b=function(a,b=640){return`https://cdn.jwplayer.com/v2/media/${a}/poster.mp4?width=${b}`}(a,640);try{let a=await fetch(b,{method:"GET",redirect:"manual"});if(302===a.status||a.ok)return b;return null}catch{return null}}async function s(a){try{return(await fetch(p(a),{method:"HEAD"})).ok}catch{return!1}}function t(a){if(a.custom_params?.trailerId)return a.custom_params.trailerId;if(a.custom_params?.trailer)return a.custom_params.trailer;if(a.link){let b=a.link.match(/media\/([a-zA-Z0-9]{8})/);if(b)return b[1];if(a.link.match(/^[a-zA-Z0-9]{8}$/))return a.link}return a.trailerId?a.trailerId:null}},36927:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{E:()=>j,s:()=>g});var e=c(93721),f=a([e]);e=(f.then?(await f)():f)[0];let h="https://dmbnsvghqluajdvdsmvu.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY||"",j=h&&i?(0,e.createClient)(h,i,{auth:{persistSession:!1}}):null;async function g(a){if(!a||!j)return null;let b=a.startsWith("Bearer ")?a.slice(7):a;if(!b)return null;try{let{data:{user:a},error:c}=await j.auth.getUser(b);if(c||!a)return null;return a.id}catch{return null}}d()}catch(a){d(a)}})},78335:()=>{},94768:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{I:()=>s});var e=c(55511),f=c(26695),g=c(36927),h=a([g]);g=(h.then?(await h)():h)[0];let p=new Map;async function i(a){if(p.has(a))return p.get(a)?(0,f.k$)(a):void 0;let b=await (0,f.Y_)(a);return p.set(a,b),b?(0,f.k$)(a):void 0}function j(a){return p.has(a)?p.get(a)?(0,f.k$)(a):void 0:(0,f.k$)(a)}function k(a){if(a.contentType){let b=a.contentType.toLowerCase();if("trailer"===b)return"Trailer";if("episode"===b)return"Episode";if("series"===b)return"Series";if("movie"===b)return"Movie";if("documentary"===b)return"Documentary"}let b=a.custom_params?.content_type||a.custom_params?.contentType||a.custom_params?.ContentType||a.custom_params?.type;if(b){let a=b.toLowerCase();if("trailer"===a)return"Trailer";if("episode"===a)return"Episode";if("series"===a)return"Series";if("movie"===a)return"Movie";if("documentary"===a)return"Documentary"}let c=a.tags?.toLowerCase()||"",d=a.title?.toLowerCase()||"";return c.includes("trailer")||d.includes("trailer")?"Trailer":c.includes("documentary")||c.includes("doc")?"Documentary":c.includes("movie")||c.includes("film")?"Movie":c.includes("episode")||d.match(/episode\s*\d+/i)||d.match(/ep\s*\d+/i)?"Episode":"Series"}function l(a){let b=!!a.pubdate&&Date.now()/1e3-a.pubdate<2592e3,c=(0,f.o3)(a),d=a.rating||a.custom_params?.rating||a.custom_params?.Rating||a.custom_params?.content_rating||"TV-MA",e=a.genre?[a.genre]:a.tags?.split(",").map(a=>a.trim())||[],g=k(a);return{id:a.mediaid,title:a.title,posterImage:a.image||(0,f.ZZ)(a.mediaid),verticalPosterImage:(0,f.Yu)(a.mediaid),heroImage:(0,f.GV)(a.mediaid),motionThumbnail:(0,f.Cp)(a.images)||void 0,logoImage:j(a.mediaid),rating:d,genres:e.length>0?e.slice(0,2):void 0,description:a.description||void 0,isNew:b,isNewEpisode:!1,mediaId:a.mediaid,duration:a.duration,trailerId:c||void 0,contentType:g}}let q=new Map;async function m(a){if(a.motionThumbnail)return a;let b=a.mediaId||a.id;if(!b)return a;if(q.has(b)){let c=q.get(b);return c?{...a,motionThumbnail:c}:a}let c=await (0,f.$m)(b);return(q.set(b,c),c)?{...a,motionThumbnail:c}:a}async function n(a){return Promise.all(a.map(m))}function o(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'")}class r{constructor(){this.categoryMapBuilt=!1,this.categoryMapPromise=null,this.lastFetch=0,this.isInitialized=!1,this.refreshPromise=null,this.users=new Map,this.allContent=new Map,this.searchableContent=new Map,this.mediaCategoryMap=new Map,this.heroItems=[],this.contentRows=[]}async refreshJWPlayerContent(){if(!(Date.now()-this.lastFetch<6e4)||!this.isInitialized){if(this.refreshPromise)return this.refreshPromise;this.refreshPromise=this.doRefreshJWPlayerContent();try{await this.refreshPromise}finally{this.refreshPromise=null}}}async doRefreshJWPlayerContent(){let a=Date.now();console.log("Fetching content from JW Player playlists...");let[b,c,d,e,g,h]=await Promise.all([(0,f.dB)(f.CI.heroBanner),(0,f.dB)(f.CI.featured),(0,f.dB)(f.CI.recommended),(0,f.dB)(f.CI.popular),(0,f.dB)(f.CI.newMovies),(0,f.dB)(f.CI.documentaries)]),m=b.length+c.length+d.length+e.length+g.length+h.length,p=a=>{let b=a.title?.toLowerCase()||"",c=a.tags?.toLowerCase()||"";return!b.includes("trailer")&&!c.includes("trailer")},q=a=>p(a)&&(a=>{let b=k(a);return"Episode"!==b})(a);if(m>0){console.log(`Found ${m} total items from JW Player playlists`),this.lastFetch=a,this.isInitialized=!0;let r=b.filter(p),s=c.filter(q),t=new Set;[...r,...s,...d,...e,...g,...h].forEach(a=>t.add(a.mediaid)),await Promise.all([...t].map(a=>i(a)));let u=r.map(a=>(function(a){let b=a.tags?.split(",").map(a=>a.trim())||[],c=!!a.pubdate&&Date.now()/1e3-a.pubdate<2592e3,d=(0,f.o3)(a),e=a.rating||a.custom_params?.rating||a.custom_params?.Rating||a.custom_params?.content_rating||"TV-MA",g=a.genre?[a.genre]:b.length>0?b.slice(0,2):["Entertainment"],h=k(a),i=j(a.mediaid);return{id:a.mediaid,title:a.title.toUpperCase(),type:"movie"===h.toLowerCase()?"movie":"series",heroImage:(0,f.GV)(a.mediaid),motionThumbnail:(0,f.Cp)(a.images)||void 0,logoImage:i,rating:e,genres:g,description:a.description||"Watch this exclusive content now available on Bolt TV.",isNew:c,mediaId:a.mediaid,trailerId:d||void 0,contentType:h}})(a));this.heroItems=await n(u);let v=[{id:"r1",title:"Featured",items:s.map(a=>l(a))},{id:"r2",title:"Recommended For You",items:d.filter(q).map(a=>l(a))},{id:"r3",title:"Popular",items:e.filter(q).map(a=>l(a))},{id:"r4",title:"New Movies",items:g.filter(q).map(a=>l(a))},{id:"r5",title:"Documentaries",items:h.filter(q).map(a=>l(a))}];this.contentRows=await Promise.all(v.map(async a=>({...a,items:await n(a.items)}))),this.allContent.clear(),this.searchableContent.clear(),this.heroItems.forEach(a=>this.allContent.set(a.id,a)),this.contentRows.forEach(a=>{a.items.forEach(a=>this.allContent.set(a.id,a))});let w=[...c,...d,...e,...g,...h],x=[];for(let a of w){this.allContent.has(a.mediaid)||this.allContent.set(a.mediaid,l(a));let b=(0,f.o3)(a);b&&!this.allContent.has(b)&&x.push(b);let c=a.title?.toLowerCase()||"",d=a.tags?.toLowerCase()||"";c.includes("trailer")||d.includes("trailer")||this.searchableContent.has(a.mediaid)||this.searchableContent.set(a.mediaid,{item:l(a),title:o(a.title).toLowerCase(),tags:o(d).toLowerCase(),description:o(a.description||"").toLowerCase()})}if(x.length>0){let a=[...new Set(x)].map(a=>(0,f.Du)(a));for(let b of(await Promise.all(a)))b&&!this.allContent.has(b.mediaid)&&this.allContent.set(b.mediaid,l(b))}this.categoryMapBuilt||this.categoryMapPromise||(this.categoryMapPromise=this.buildCategoryMap())}else console.log("No JW Player content found, using fallback data"),this.isInitialized||(this.initializeFallbackContent(),this.isInitialized=!0)}initializeFallbackContent(){this.heroItems=[{id:"h1",title:"GRIT & GLORY",type:"series",heroImage:"/assets/hero-grit-glory.png",rating:"TV-MA",seasonCount:1,genres:["Sports","Drama"],description:"On the field, every second counts. Behind the scenes, the pressure never stops. Witness the untold stories of determination and sacrifice.",isNew:!0},{id:"h2",title:"THE BOARDROOM",type:"series",heroImage:"/assets/hero-drama.png",rating:"TV-MA",seasonCount:4,genres:["Drama","Business"],description:"Power, betrayal, and billions of dollars. The Roy family saga continues as alliances shift and new enemies emerge.",isNew:!0},{id:"h3",title:"DUNE: PROPHET",type:"movie",heroImage:"/assets/hero-scifi.png",rating:"PG-13",genres:["Sci-Fi","Adventure"],description:"A mythic and emotionally charged hero's journey, Dune tells the story of Paul Atreides, a brilliant and gifted young man born into a great destiny beyond his understanding.",isNew:!1}];let a=[{id:"f1",title:"Grit & Glory: Bo Nix",posterImage:"/assets/poster-grit-bo.png",rating:"TV-MA",seasonCount:1,isNew:!0,isNewEpisode:!0},{id:"f2",title:"Rookie",posterImage:"/assets/poster-rookie.png",rating:"TV-14",seasonCount:1,isNew:!0},{id:"f3",title:"Traviesa",posterImage:"/assets/poster-traviesa.png",rating:"TV-MA",isNew:!0},{id:"f4",title:"Surfing The Midnight Sun",posterImage:"/assets/poster-surfing.png",rating:"TV-PG",isNew:!1},{id:"f5",title:"Full Throttle",posterImage:"/assets/poster-full-throttle.png",rating:"TV-14",seasonCount:2,isNew:!1},{id:"f6",title:"DTM: Beyond The Grid",posterImage:"/assets/poster-dtm.png",rating:"TV-MA",isNew:!0},{id:"f7",title:"Grit & Glory: Arch Manning",posterImage:"/assets/poster-grit-arch.png",rating:"TV-MA",seasonCount:1,isNew:!0},{id:"f8",title:"Life On Ice",posterImage:"/assets/poster-life-on-ice.png",rating:"TV-14",seasonCount:3,isNew:!1}];this.contentRows=[{id:"r1",title:"Featured",items:a},{id:"r2",title:"Recommended For You",items:a.slice(0,5)},{id:"r3",title:"Popular",items:a},{id:"r4",title:"New Movies",items:a.filter(a=>a.isNew)},{id:"r5",title:"Documentaries",items:a.slice(2,6)}],this.allContent.clear(),this.heroItems.forEach(a=>this.allContent.set(a.id,a)),this.contentRows.forEach(a=>{a.items.forEach(a=>this.allContent.set(a.id,a))})}async getUser(a){return this.users.get(a)}async getUserByUsername(a){return Array.from(this.users.values()).find(b=>b.username===a)}async createUser(a){let b=(0,e.randomUUID)(),c={...a,id:b};return this.users.set(b,c),c}async getHeroItems(){return await this.refreshJWPlayerContent(),this.heroItems}async getContentRows(){return await this.refreshJWPlayerContent(),this.contentRows}async getContentById(a){return await this.refreshJWPlayerContent(),this.allContent.get(a)}async getSportCategories(){return f.te.map(a=>({id:a.slug,name:a.name,slug:a.slug,playlistId:a.id,thumbnailImage:`/assets/sport-${a.slug}.jpg`}))}async getSportContent(a){let b=(await (0,f.dB)(a)).filter(a=>{let b=a.title?.toLowerCase()||"",c=a.tags?.toLowerCase()||"";return!b.includes("trailer")&&!c.includes("trailer")}),c=f.te.find(b=>b.id===a);if(c)for(let a of b)this.mediaCategoryMap.set(a.mediaid,c.slug);let d=b.map(a=>l(a));return n(d)}async getSeriesEpisodes(a){if(await this.refreshJWPlayerContent(),!this.allContent.get(a))return[];try{let b=await (0,f.c2)(a);if(b&&b.seasons&&b.seasons.length>0){let c=[];for(let d of b.seasons)for(let b of(await (0,f.AV)(a,d.season_number)))c.push({id:b.media_item.mediaid,title:b.media_item.title,description:b.media_item.description||"",duration:b.media_item.duration,image:b.media_item.image||(0,f.ZZ)(b.media_item.mediaid),episodeNumber:b.episode_number,seasonNumber:d.season_number,mediaId:b.media_item.mediaid});if(c.length>0)return console.log(`Found ${c.length} episodes for series ${a} via Series API`),c}}catch(a){console.log("Could not fetch series episodes from Series API:",a)}try{let b=await (0,f.Du)(a);if(b){let a=b.custom_params?.playlistId||b.custom_params?.PlaylistId||b.custom_params?.season1||b.custom_params?.Season1;if(a)return(await (0,f.dB)(a)).map((a,b)=>({id:a.mediaid,title:a.title,description:a.description||"",duration:a.duration,image:a.image||(0,f.ZZ)(a.mediaid),episodeNumber:b+1,seasonNumber:1,mediaId:a.mediaid}))}}catch(a){console.log("Could not fetch series media for episode playlist:",a)}let b=[];for(let c of[f.CI.heroBanner,f.CI.featured,f.CI.recommended,f.CI.popular,f.CI.newMovies,f.CI.documentaries,...f.te.map(a=>a.id)])try{for(let d of(await (0,f.dB)(c)))d.mediaid!==a&&((d.custom_params?.series_id||d.custom_params?.seriesId||d.custom_params?.SeriesId)!==a||b.find(a=>a.id===d.mediaid)||b.push({id:d.mediaid,title:d.title,description:d.description||"",duration:d.duration,image:d.image||(0,f.ZZ)(d.mediaid),episodeNumber:b.length+1,seasonNumber:1,mediaId:d.mediaid}))}catch(a){}if(b.length>0)return b.slice(0,12);let c=this.mediaCategoryMap.get(a);if(c){let b=f.te.find(a=>a.slug===c);if(b)return(await (0,f.dB)(b.id)).filter(b=>{if(b.mediaid===a)return!1;let c=b.title?.toLowerCase()||"",d=b.tags?.toLowerCase()||"";return!c.includes("trailer")&&!d.includes("trailer")}).slice(0,8).map((a,b)=>({id:a.mediaid,title:a.title,description:a.description||"",duration:a.duration,image:a.image||(0,f.ZZ)(a.mediaid),episodeNumber:b+1,seasonNumber:1,mediaId:a.mediaid}))}return[]}async buildCategoryMap(){for(let a of(console.log("Building category map from sport playlists..."),f.te))try{for(let b of(await (0,f.dB)(a.id)))this.mediaCategoryMap.set(b.mediaid,a.slug)}catch{}this.categoryMapBuilt=!0,console.log(`Category map built with ${this.mediaCategoryMap.size} entries`)}async ensureCategoryMapReady(){if(!this.categoryMapBuilt){this.categoryMapPromise||(this.categoryMapPromise=this.buildCategoryMap());try{await Promise.race([this.categoryMapPromise,new Promise((a,b)=>setTimeout(()=>b(Error("Category map timeout")),1e4))])}catch(a){console.warn("Category map build timeout or error, proceeding without category")}}}getCategoryForMedia(a){return this.mediaCategoryMap.get(a)}async updateWatchProgress(a,b,c,d,e,f,h,i){if(!g.E)throw Error("Supabase admin client not configured");let j=e>0?Math.min(f/e,1):0;await this.ensureCategoryMapReady();let k=h||this.mediaCategoryMap.get(b),l=g.E.from("watch_history").select("*").eq("media_id",b);l=i?l.eq("user_id",i):l.eq("session_id",a);let{data:m}=await l.limit(1);if(m&&m.length>0){let{data:a,error:b}=await g.E.from("watch_history").update({watched_seconds:f,progress:j,last_watched_at:new Date().toISOString(),title:c,poster_image:d,duration:e,...i&&{user_id:i},...k&&{category:k}}).eq("id",m[0].id).select().single();if(b)throw b;return this.mapWatchHistoryRow(a)}{let{data:h,error:l}=await g.E.from("watch_history").insert({session_id:a,media_id:b,title:c,poster_image:d,duration:e,watched_seconds:f,progress:j,category:k||null,...i&&{user_id:i}}).select().single();if(l)throw l;return this.mapWatchHistoryRow(h)}}async getContinueWatching(a,b){if(!g.E)return[];let c=g.E.from("watch_history").select("*").gt("progress",.01).lt("progress",.95).order("last_watched_at",{ascending:!1}).limit(20);c=b?c.eq("user_id",b):c.eq("session_id",a);let{data:d,error:e}=await c;return e||!d?[]:d.filter(a=>!(a.title?.toLowerCase()||"").includes("trailer")).map(a=>({id:a.id,mediaId:a.media_id,title:a.title,posterImage:a.poster_image||"",horizontalPosterLogo:(0,f.xX)(a.media_id),duration:a.duration,watchedSeconds:a.watched_seconds,progress:a.progress,lastWatchedAt:new Date(a.last_watched_at)}))}async removeFromContinueWatching(a,b,c){if(!g.E)return;let d=g.E.from("watch_history").delete().eq("media_id",b);d=c?d.eq("user_id",c):d.eq("session_id",a),await d}async searchContent(a){await this.refreshJWPlayerContent();let b=a.toLowerCase(),c=[],d=new Set;for(let[a,e]of this.searchableContent.entries()){if(d.has(a))continue;let f=e.title.includes(b),g=e.tags.includes(b),h=e.description.includes(b);(f||g||h)&&(d.add(a),c.push(e.item))}for(let a of f.te)for(let e of(await (0,f.dB)(a.id))){if(d.has(e.mediaid))continue;let f=o(e.title).toLowerCase(),g=o(e.tags||"").toLowerCase(),h=o(e.description||"").toLowerCase(),i=f.includes(b),j=g.includes(b),k=h.includes(b),m=a.name.toLowerCase().includes(b);(i||j||k||m)&&(d.add(e.mediaid),c.push(l(e)))}return c}async getPersonalizedRecommendations(a){try{return(await (0,f.dB)("hkXBUtcd")).map(a=>l(a))}catch(a){return console.error("Error fetching JW Player recommendations:",a),[]}}async getNextEpisodeToWatch(a,b,c){let d=await this.getSeriesEpisodes(b);if(0===d.length)return null;let e=[...d].sort((a,b)=>{let c=(a.seasonNumber||1)-(b.seasonNumber||1);return 0!==c?c:(a.episodeNumber||1)-(b.episodeNumber||1)}),f=e.map(a=>a.mediaId),h=[];if(g.E&&f.length>0){let b=g.E.from("watch_history").select("*").in("media_id",f);b=c?b.eq("user_id",c):b.eq("session_id",a);let{data:d}=await b;h=d||[]}let i=new Map;for(let a of h)i.set(a.media_id,a.progress);let j=-1,k=null;for(let a=0;a<e.length;a++){let b=e[a],c=i.get(b.mediaId)||0;c>.01&&c<.95&&(k={seasonNumber:b.seasonNumber||1,episodeNumber:b.episodeNumber||a+1,mediaId:b.mediaId}),c>=.95&&(j=a)}if(k)return k;if(j>=0&&j<e.length-1){let a=e[j+1];return{seasonNumber:a.seasonNumber||1,episodeNumber:a.episodeNumber||j+2,mediaId:a.mediaId}}if(j===e.length-1){let a=e[j];return{seasonNumber:a.seasonNumber||1,episodeNumber:a.episodeNumber||e.length,mediaId:a.mediaId}}let l=e[0];return{seasonNumber:l.seasonNumber||1,episodeNumber:l.episodeNumber||1,mediaId:l.mediaId}}async getFirstEpisode(a){let b=await this.getSeriesEpisodes(a);if(0===b.length)return null;let c=b.sort((a,b)=>{let c=(a.seasonNumber||1)-(b.seasonNumber||1);return 0!==c?c:(a.episodeNumber||1)-(b.episodeNumber||1)})[0];return{seasonNumber:c.seasonNumber||1,episodeNumber:c.episodeNumber||1,mediaId:c.mediaId}}async migrateSessionToUser(a,b){if(!g.E)return;let{data:c}=await g.E.from("watch_history").select("*").eq("session_id",a).is("user_id",null);if(c)for(let a of c){let{data:c}=await g.E.from("watch_history").select("*").eq("user_id",b).eq("media_id",a.media_id).limit(1);c&&c.length>0?(new Date(a.last_watched_at)>new Date(c[0].last_watched_at)&&await g.E.from("watch_history").update({watched_seconds:a.watched_seconds,progress:a.progress,last_watched_at:a.last_watched_at}).eq("id",c[0].id),await g.E.from("watch_history").delete().eq("id",a.id)):await g.E.from("watch_history").update({user_id:b}).eq("id",a.id)}}mapWatchHistoryRow(a){return{id:a.id,sessionId:a.session_id,userId:a.user_id||null,mediaId:a.media_id,title:a.title,posterImage:a.poster_image||null,duration:a.duration,watchedSeconds:a.watched_seconds,progress:a.progress,lastWatchedAt:new Date(a.last_watched_at),category:a.category||null}}}let s=new r;d()}catch(a){d(a)}})},96487:()=>{}};