"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6070],{5016:(e,r,t)=>{t.d(r,{cn:()=>a});var n=t(2821),i=t(5889);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,i.QP)((0,n.$)(r))}},5626:(e,r,t)=>{t.d(r,{A:()=>n});let n=(0,t(1847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6070:(e,r,t)=>{t.r(r),t.d(r,{default:()=>y});var n=t(5155),i=t(63),a=t(2619),l=t.n(a),o=t(2115),s=t(5626),c=t(9776),d=t(2454),u=t(3857),w=t(7062),h=t(6707);function y(){let e=(0,i.useParams)().id,r=(0,i.useRouter)(),{hasActiveSubscription:t,isLoading:a}=(0,h.A)(),y=(0,c.jE)(),p=(0,o.useRef)(null),[m,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(null),[g,x]=(0,o.useState)(!1),j=(0,o.useRef)(null),k=(0,o.useRef)(0),I=(0,o.useRef)(null),N=(0,o.useRef)("https://cdn.jwplayer.com/libraries/EBg26wOK.js");(0,o.useEffect)(()=>{a||t||r.push("/subscribe")},[a,t,r]);let{data:z,isLoading:S,error:E}=(0,d.I)({queryKey:["/api/content/".concat(e)],enabled:!!e,retry:!1}),P=(null==z?void 0:z.contentType)==="Series",A=!S&&!!z,C=!S&&!z,R=P||C,T=(0,u.u)(),{data:F,isLoading:L,isFetched:W}=(0,d.I)({queryKey:["/api/series/".concat(e,"/next-episode"),T],queryFn:async()=>{let r=await (0,u.z)(),t=await fetch("/api/series/".concat(e,"/next-episode"),{headers:r});return t.ok?t.json():null},enabled:!!e&&!S&&R,retry:!1}),q=P?(null==F?void 0:F.mediaId)||void 0:C&&(null==F?void 0:F.mediaId)?F.mediaId:(null==z?void 0:z.mediaId)||(z?e:void 0),D=S||R&&L,H=P&&W&&!F,J=A&&!P&&!(null==z?void 0:z.mediaId),K=H||J||!S&&!z&&(!R||W&&!F),U=(0,o.useCallback)(async(e,r)=>{if(!q||0===r)return;let t=new URLSearchParams(window.location.search).get("category")||(null==z?void 0:z.category);try{let n=(0,u.u)(),i=await (0,u.z)();await fetch("/api/watch-progress",{method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify({sessionId:n,mediaId:q,title:(null==z?void 0:z.title)||"",posterImage:(null==z?void 0:z.posterImage)||"",duration:Math.round(r),watchedSeconds:Math.round(e),category:t})})}catch(e){console.error("Failed to save watch progress:",e)}},[z,q]);return((0,o.useEffect)(()=>{(async()=>{if(window.jwplayer)return x(!0);try{let e=await fetch("/api/player-config");if(e.ok){let r=await e.json();r.libraryUrl&&(N.current=r.libraryUrl)}}catch(e){}let e=N.current;if(window.jwplayer)return x(!0);let r=e=>{let r=document.createElement("script");r.src=e,r.async=!0,r.onload=()=>{let e=setInterval(()=>{window.jwplayer&&(clearInterval(e),x(!0))},50);setTimeout(()=>{clearInterval(e),window.jwplayer||b("Failed to initialize JW Player.")},5e3)},r.onerror=()=>{b("Failed to load video player library.")},document.head.appendChild(r)},t=document.querySelector('script[src*="cdn.jwplayer.com/libraries"]');if(t){if((t.getAttribute("src")||"")!==e)t.remove(),r(e);else{let n=setInterval(()=>{window.jwplayer&&(clearInterval(n),x(!0))},50);setTimeout(()=>{clearInterval(n),window.jwplayer||(t.remove(),r(e))},3e3)}return}r(e)})()},[]),(0,o.useEffect)(()=>{if(g&&q&&p.current&&!K)return(()=>{try{if(j.current){try{j.current.remove()}catch(e){}j.current=null}let e=p.current;if(!e)return;e.id="jwplayer-".concat(Date.now());let r=window.jwplayer(e);j.current=r,r.setup({playlist:"https://cdn.jwplayer.com/v2/media/".concat(q),width:"100%",height:"100%",autostart:!0,mute:!1,controls:!0,stretching:"uniform",playsinline:!0}),r.on("ready",()=>{r.resize(window.innerWidth,window.innerHeight),setTimeout(()=>{r.resize(window.innerWidth,window.innerHeight)},100);let e=()=>{j.current&&j.current.resize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),r.on("remove",()=>{window.removeEventListener("resize",e)}),f(!0),b(null)}),r.on("play",()=>{I.current&&clearInterval(I.current),I.current=setInterval(()=>{if(j.current){let e=j.current.getPosition()||0,r=j.current.getDuration()||0;e-k.current>=5&&(k.current=e,U(e,r))}},5e3)}),r.on("pause",()=>{if(j.current){let e=j.current.getPosition()||0,r=j.current.getDuration()||0;U(e,r)}}),r.on("complete",()=>{if(I.current&&clearInterval(I.current),j.current){let e=j.current.getDuration()||0;U(e,e)}}),r.on("error",e=>{console.error("JW Player error:",e),b("Unable to play this video.")}),r.on("setupError",e=>{console.error("JW Player setup error:",e),b("Video player setup failed.")}),setTimeout(()=>{!m&&r.getState&&"idle"!==r.getState()&&f(!0)},2e3)}catch(e){console.error("Player init error:",e),b("Failed to initialize video player.")}})(),()=>{if(I.current&&clearInterval(I.current),j.current){var e,r,t,n;let i=(null==(e=(r=j.current).getPosition)?void 0:e.call(r))||0,a=(null==(t=(n=j.current).getDuration)?void 0:t.call(n))||0;i>0&&a>0&&U(i,a);try{j.current.remove()}catch(e){}j.current=null}y.invalidateQueries({queryKey:["/api/continue-watching",(0,u.u)()]})}},[g,q,U,y,K]),a||!t)?(0,n.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,n.jsx)(w.A,{size:"lg"})}):(0,n.jsxs)("div",{className:"watch-player-wrapper",children:[(0,n.jsx)("button",{onClick:()=>{window.history.length>1?window.history.back():r.push("/home")},className:"fixed top-4 left-4 z-50 flex items-center gap-2 text-white hover:text-gray-300 transition bg-black/50 px-3 py-2 rounded-full","data-testid":"button-back",children:(0,n.jsx)(s.A,{className:"w-5 h-5"})}),K&&(0,n.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-black z-10",children:[(0,n.jsx)("div",{className:"text-xl text-red-400 mb-4",children:"Content not found"}),(0,n.jsx)("p",{className:"text-gray-400 mb-4",children:"This video is no longer available."}),(0,n.jsx)(l(),{href:"/home",children:(0,n.jsx)("button",{className:"px-4 py-2 bg-white text-black rounded font-medium hover:bg-gray-200 transition",children:"Go Home"})})]}),!K&&(D||!m)&&!v&&(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black z-10 pointer-events-none",children:(0,n.jsx)(w.A,{size:"lg"})}),!K&&v&&(0,n.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-black z-10",children:[(0,n.jsx)("div",{className:"text-xl text-red-400 mb-4",children:v}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-white text-black rounded font-medium hover:bg-gray-200 transition",children:"Retry"})]}),(0,n.jsx)("div",{ref:p,className:"jw-player-container","data-testid":"video-player"})]})}},7062:(e,r,t)=>{t.d(r,{A:()=>a});var n=t(5155),i=t(5016);function a(e){let{size:r="md",className:t}=e;return(0,n.jsx)("div",{className:(0,i.cn)("rounded-full animate-spin","border-transparent border-t-white border-r-white",{sm:"w-6 h-6 border-2",md:"w-10 h-10 border-3",lg:"w-14 h-14 border-4"}[r],t),style:{borderStyle:"solid",background:"transparent"},role:"status","aria-label":"Loading"})}}}]);