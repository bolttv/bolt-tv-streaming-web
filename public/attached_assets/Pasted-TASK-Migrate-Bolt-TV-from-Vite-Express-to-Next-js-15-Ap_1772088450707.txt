TASK: Migrate Bolt TV from Vite + Express to Next.js 15 (App Router)

CONTEXT:
This is a sports documentary streaming platform (like Netflix/Hulu). It currently uses:
- Vite as the build tool
- React 19 with Wouter for client-side routing
- Express backend serving API routes
- JW Player for video (Player ID: xQRl7M0d, Site ID: dbT1F4Hr)
- Supabase for auth and database
- Cleeng for subscriptions (Publisher ID: 870553921)
- Tailwind CSS 4 + Radix/shadcn for UI
- TanStack Query for data fetching
- TypeScript across the stack

WHAT TO DO:

1. CREATE NEW NEXT.JS 15 PROJECT with App Router in the current workspace:
   - Run: npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir=false --import-alias="@/*" --turbopack
   - If prompted about overwriting, confirm yes
   - This replaces Vite entirely

2. PACKAGE.JSON CHANGES:
   REMOVE these dependencies:
   - vite, @vitejs/plugin-react, @tailwindcss/vite (Vite stack)
   - wouter (replaced by Next.js file routing)
   - express, @types/express, compression, @types/compression (replaced by Route Handlers)
   - drizzle-orm, drizzle-kit, @neondatabase/serverless, postgres (unused)
   - ws, @types/ws (unused)
   - tsx, esbuild (replaced by Next.js build)
   - Any @replit/vite-plugin-* packages
   
   KEEP all @radix-ui/*, @tanstack/react-query, @supabase/supabase-js, 
   framer-motion, lucide-react, tailwind-merge, class-variance-authority, 
   clsx, zod, sonner, recharts, embla-carousel-react, next-themes,
   react-hook-form, @hookform/resolvers, date-fns, cmdk, vaul,
   tailwindcss-animate, tw-animate-css, @anthropic-ai/sdk, and all other 
   UI/utility packages.

3. DELETE these files/folders:
   - vite.config.ts
   - server/ (entire directory)
   - shared/ (entire directory) 
   - script/ (entire directory)
   - client/ wrapper (flatten client/src/ content into Next.js structure)
   - main.tsx and index.html (replaced by Next.js layout.tsx)
   - drizzle.config.ts
   - vercel.json (Next.js handles this)

4. CREATE THIS FILE STRUCTURE:
   
   app/
   ├── layout.tsx              — Root layout with <html>, providers, nav, JW Player script
   ├── page.tsx                — Public landing page (SSR)
   ├── loading.tsx             — Global loading skeleton
   ├── not-found.tsx           — Custom 404
   ├── (public)/
   │   ├── login/page.tsx
   │   └── signup/page.tsx
   ├── (app)/
   │   ├── layout.tsx          — Auth protection wrapper
   │   ├── browse/page.tsx     — Main content (hero + rows) — SERVER COMPONENT
   │   ├── watch/[id]/page.tsx — Video player — CLIENT COMPONENT  
   │   ├── content/[id]/page.tsx — Media detail — SERVER COMPONENT
   │   ├── series/[id]/page.tsx  — Series + episodes — SERVER COMPONENT
   │   ├── search/page.tsx     — Search — CLIENT COMPONENT
   │   ├── sport/[id]/page.tsx — Sport category — SERVER COMPONENT
   │   ├── subscribe/page.tsx  — Plan selection — CLIENT COMPONENT
   │   ├── checkout/page.tsx   — Payment — CLIENT COMPONENT
   │   └── account/page.tsx    — Profile — CLIENT COMPONENT
   └── api/
       ├── content/hero/route.ts
       ├── content/rows/route.ts
       ├── content/[id]/route.ts
       ├── series/[seriesId]/episodes/route.ts
       ├── series/[seriesId]/next-episode/route.ts
       ├── search/route.ts
       ├── sports/route.ts
       ├── sports/[id]/content/route.ts
       ├── recommendations/[id]/route.ts
       ├── watch-progress/route.ts
       ├── continue-watching/[sessionId]/route.ts
       ├── continue-watching/[sessionId]/[mediaId]/route.ts
       ├── migrate-watch-history/route.ts
       ├── cleeng/config/route.ts
       ├── cleeng/offers/route.ts
       ├── cleeng/sso/route.ts
       ├── cleeng/subscriptions/[token]/route.ts
       ├── cleeng/checkout/route.ts
       └── cleeng/tax/route.ts
   
   components/
   ├── ui/           — Move ALL existing Radix/shadcn components here, add "use client" to each
   ├── providers.tsx  — "use client" — wraps QueryClientProvider + AuthProvider + ThemeProvider
   ├── hero-carousel.tsx — "use client"
   ├── content-row.tsx   — "use client"
   ├── video-player.tsx  — "use client" — JW Player embed
   └── nav-bar.tsx       — "use client"
   
   lib/
   ├── jwplayer.ts      — MOVE from server/jwplayer.ts (JW Player API functions)
   ├── storage.ts       — MOVE from server/storage.ts (content caching layer)
   ├── cleeng.ts        — MOVE from client/src/lib/cleeng.ts
   ├── supabase/
   │   ├── client.ts    — Browser Supabase client (from client/src/lib/supabase.ts)
   │   └── server.ts    — NEW: Server-side Supabase client using createServerClient
   ├── auth-context.tsx  — MOVE from client/src/lib/AuthContext.tsx, add "use client"
   ├── session.ts        — MOVE from client/src/lib/session.ts
   └── utils.ts          — cn() helper + shared utilities
   
   middleware.ts         — NEW: Protect /browse, /watch, /account etc. Redirect unauthed → /login

5. ROUTE HANDLER PATTERN — Convert each Express endpoint using this pattern:

   Express (BEFORE):
   app.get("/api/content/hero", async (req, res) => {
     try {
       const data = await storage.getHeroItems();
       res.json(data);
     } catch (error) {
       res.status(500).json({ error: "Failed" });
     }
   });
   
   Next.js Route Handler (AFTER) — app/api/content/hero/route.ts:
   import { NextResponse } from 'next/server';
   import { getHeroItems } from '@/lib/storage';
   
   export async function GET() {
     try {
       const data = await getHeroItems();
       return NextResponse.json(data);
     } catch {
       return NextResponse.json({ error: 'Failed' }, { status: 500 });
     }
   }

6. SERVER COMPONENTS — Content pages that don't need interactivity should be 
   Server Components (NO "use client"). They can directly import and call 
   lib/storage.ts and lib/jwplayer.ts functions:

   // app/(app)/browse/page.tsx — NO "use client" = Server Component
   import { getHeroItems, getContentRows } from '@/lib/storage';
   import { HeroCarousel } from '@/components/hero-carousel';
   import { ContentRow } from '@/components/content-row';
   
   export const revalidate = 60; // Rebuild cached page every 60 seconds
   
   export default async function BrowsePage() {
     const [heroItems, rows] = await Promise.all([
       getHeroItems(),
       getContentRows(),
     ]);
     return (
       <>
         <HeroCarousel items={heroItems} />
         {rows.map(row => <ContentRow key={row.id} {...row} />)}
       </>
     );
   }

7. CLIENT COMPONENTS — Pages with useState, useEffect, event handlers, or 
   browser APIs MUST have "use client" at the top. This includes:
   - Watch page (JW Player embed)
   - Search page (real-time input)
   - Subscribe/Checkout (Cleeng SDK)
   - Account page (form state)
   - All Radix/shadcn UI components
   - HeroCarousel, ContentRow (carousel interactions)
   - AuthContext, providers

8. ENVIRONMENT VARIABLES — Create .env.local:
   NEXT_PUBLIC_SUPABASE_URL=https://kwbnjujvuloqrugsjiex.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=(existing anon key)
   NEXT_PUBLIC_JW_PLAYER_SITE_ID=dbT1F4Hr
   NEXT_PUBLIC_JW_PLAYER_ID=xQRl7M0d
   NEXT_PUBLIC_CLEENG_PUBLISHER_ID=870553921
   
   Replace any import.meta.env.VITE_* references with process.env.NEXT_PUBLIC_*

9. JW PLAYER SCRIPT — Load via next/script in layout.tsx:
   import Script from 'next/script';
   <Script src="https://cdn.jwplayer.com/libraries/xQRl7M0d.js" strategy="afterInteractive" />

10. ROOT LAYOUT (app/layout.tsx):
    - Import global CSS (Tailwind)
    - Wrap children with <Providers> (QueryClient + Auth + Theme)
    - Include nav bar
    - Include JW Player script
    - Set metadata (title, description, OG tags)

11. MIDDLEWARE (middleware.ts):
    - Check Supabase auth session
    - Protected paths: /browse, /watch, /content, /series, /sport, /subscribe, /checkout, /account
    - Public paths: /, /login, /signup, /plans, /api/*
    - Redirect unauthenticated users to /login

12. TAILWIND CONFIG — Update for Next.js:
    - content paths: ["./app/**/*.{ts,tsx}", "./components/**/*.{ts,tsx}", "./lib/**/*.{ts,tsx}"]
    - Remove any Vite-specific plugins

13. AFTER MIGRATION, VERIFY:
    - npm run dev starts Next.js dev server (not Vite)
    - Landing page renders at /
    - /browse shows hero carousel + content rows (server-rendered)
    - /watch/[id] plays video in JW Player
    - /content/[id] shows media details
    - Search works at /search
    - Auth flow works (login → redirect to /browse)
    - Cleeng subscription flow works
    - All API routes respond correctly at /api/*

CRITICAL RULES:
- Do NOT mix up "use client" and server components. Only add "use client" to components that NEED browser APIs (useState, useEffect, onClick, etc.)
- Do NOT use import.meta.env anywhere — use process.env
- Do NOT create an Express server — Next.js IS the server
- Do NOT install Vite or any Vite plugins
- Keep ALL existing business logic, styling, and component code — this is a framework migration, not a rewrite
- Preserve the existing design aesthetic (dark theme, champagne gold accents #D4AF37)