The current checkout implementation for Bolt TV is broken and needs to be rebuilt from scratch using Cleeng's official MediaStore SDK. Here's what happened and what needs to change.
The previous implementation tried to handle payments server-side by manually calling Cleeng's REST API — creating orders via POST /3.1/orders, recording payments via POST /3.1/payments, and passing raw card details from the frontend through the server to Cleeng. This is wrong for three reasons. First, it's a PCI compliance violation because card data (card number, CVV, expiry) should never pass through our server — it needs to be tokenized client-side by Adyen. Second, the original code was calling the deprecated registerSubscription JSON-RPC endpoint which caused the "Missing required parameter: paymentGateway" error, and the fix of manually wiring up REST endpoints bypasses all of Cleeng's built-in payment orchestration including retry logic, 3D Secure, fraud detection, and dunning management. Third, Cleeng legally requires "Powered by Cleeng" branding and their T&C link on any checkout where they are Merchant of Record, and the custom implementation doesn't include these.
Remove all of the custom server-side payment logic — the subscribe/checkout endpoint that calls /3.1/orders and /3.1/payments, the frontend code that collects card details and POSTs them to our server, any registerSubscription JSON-RPC calls, and any manual paymentGateway parameter passing. Do not remove Cleeng customer authentication (JWT handling), offer/plan configuration, webhook endpoints that receive Cleeng subscription events, or any coupon/promo code settings in the Cleeng dashboard.
Replace all of that with Cleeng's official MediaStore SDK. Install @cleeng/mediastore-sdk via npm. You also need to manually import the CSS dependencies since Cleeng removed automatic CSS imports in v4.0 for Next.js compatibility — import '@adyen/adyen-web/dist/adyen.css' and import 'react-loading-skeleton/dist/skeleton.css' in the main app entry point.
Before any MediaStore SDK components mount, configure the SDK by calling Config.setEnvironment('sandbox') (change to 'production' when going live) and Config.setPublisher('YOUR_PUBLISHER_ID') where the publisher ID comes from the Cleeng Dashboard settings. If the user is already authenticated through our own auth system and we have a Cleeng JWT, also call Config.setJWT() and Config.setRefreshToken() with those values. Optionally call Config.setTermsUrl() with our terms page URL, Config.setHidePayPal() if we only want card payments, and Config.setEnable3DSRedirectFlow() if we want to force the redirect 3D Secure flow instead of native.
The checkout page itself is a single React component. Import Checkout and store from @cleeng/mediastore-sdk and Provider from react-redux, then wrap the Checkout component in the Provider with the imported store. Pass the offerId prop (format S{numbers}_{country} like S123456789_US, found in the Cleeng Dashboard) and an onSuccess callback that redirects the user after successful payment. That single Checkout component handles the entire flow — user registration, login, offer display with price breakdown, coupon/promo code input and validation, the Adyen card payment form with PCI-compliant client-side tokenization, PayPal Express Checkout, Apple Pay, Google Pay, 3D Secure authentication, the legally required "Powered by Cleeng" footer and T&C checkbox, and the success confirmation page. Card data goes directly from the browser to Adyen through the SDK — our server never sees it.
If the user is already authenticated through our own system and we just need the payment step, use the Purchase sub-component instead of the full Checkout component. Import Purchase and Auth from the SDK, check Auth.isLogged(), and render Purchase with the offerId and onSuccess props. This skips the registration/login forms and goes straight to offer display and payment.
For the account management page, import MyAccount from the SDK and render it wrapped in the same Provider/store pattern. This gives subscribers a self-service portal with plan details, upgrade/downgrade options, payment method updates, transaction history, profile editing, and subscription cancellation with optional downgrade offers. The user must have a valid JWT set via Config.setJWT() for this to work.
The only server-side payment code we need is a webhook endpoint that receives Cleeng subscription lifecycle events (subscription.created, subscription.renewed, subscription.cancelled, payment.failed) and updates the subscription status in our Supabase database accordingly. Cleeng handles all retry logic for failed payments automatically through their dunning system — we don't need to build any of that.
Before testing, we need to contact Cleeng's technical support team to enable the payment methods we want (card, PayPal, Apple Pay, Google Pay) in our sandbox environment and provide our allowed origins/domains for Adyen whitelisting. For sandbox testing use Adyen test cards — Visa 4111 1111 1111 1111 with any future expiry and any 3-digit CVV, or the 3DS-required card 4212 3456 7891 0006 to test the 3D Secure flow. For Google Pay testing, log into a real Google account with a real card added — Adyen automatically maps it to a test card so it won't actually charge.
Style the components by targeting their CSS class names. The SDK renders standard HTML elements that can be inspected and overridden. For Bolt TV's dark theme, wrap the checkout in a container with the appropriate background and text colors. Detailed styling docs are at https://developers.cleeng.com/docs/styling.
Reference documentation: MediaStore SDK GitHub at https://github.com/Cleeng/mediastore-sdk, the demo reference app at https://github.com/Cleeng/mediastore-api-example, the integration guide at https://developers.cleeng.com/docs/components-integration-guide, payment configuration at https://developers.cleeng.com/docs/payment-configuration, and the components library overview at https://developers.cleeng.com/docs/components-library.